import sys
import os
import subprocess
import tempfile

extension_path = '/home/heinous/.config/google-chrome/Default/Extensions/'

def get_immediate_subdirectories(a_dir):
    return [name for name in os.listdir(a_dir)
            if os.path.isdir(os.path.join(a_dir, name))]

def get_js_file(extension):
    path = extension_path + extension
    js_files = {}
    for root, dirs, files in os.walk(path):
        for file in files:
            if file.endswith("js"):
                js_files[file] = os.path.join(root, file)
    return js_files

extensions = get_immediate_subdirectories(extension_path)
if os.path.exists("./CFG_files") == False:
    os.system("mkdir ./CFG_files")

for extension in extensions:
    files = get_js_file(extension)
    if os.path.exists("./CFG_files/" + extension) == False:
        os.system("mkdir ./CFG_files/" + extension)

    for file in files:
        if len(file) != 0:
            f = open('./CFG_files/' + extension + "/" + file, 'w')

            with tempfile. TemporaryFile() as tempf:
                print files[file]
                p = subprocess.Popen(['node', 'temp.js', files[file]], stdout=tempf)
                p.wait()
                tempf.seek(0)
                f.write(tempf.read())
            f.close()


