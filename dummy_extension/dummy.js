chrome.runtime.onMessage.addListener(
  function(request, sender, sendResponse) {
    if( request.message === "clicked_browser_action" ) {
      var firstHref = $("a[href^='http']").eq(0).attr("href");

      console.log(firstHref);

      // This line is new!
      //chrome.runtime.sendMessage({"message": "open_new_tab", "url": firstHref});
      console.log(window.location.href);
      window.alert("hi");
      eval("window.alert('this only happens if eval works the way i think it does')");
      var theurl = window.location.href;
      eval("window.alert('" + theurl + "')");
      eval("'" + theurl + "'");

      chrome.runtime.sendMessage({"message": "open_new_tab", "url": window.location.href});
    }
  }
);
